version: '3.8'

services:
  # Serviço da Aplicação Web (Flask)
  web:
    build: .
    # Mapeia a porta 8080 do contêiner para a porta 5000 da sua máquina local
    ports:
      - "5000:8080"
    restart: always
    # Monta o volume para hot-reloading (desenvolvimento)
    volumes:
      - .:/app
    environment:
      FLASK_ENV: development
      # Variáveis de conexão com o banco de dados (usadas no app.py)
      POSTGRES_USER: dca713a07948ca9960f186919d6d700f
      POSTGRES_PASSWORD: 7dd23931ba9b2ba58a5988c96fe8c018
      POSTGRES_DB: 6ba288924eb495dba130fd598d383dcb
      # DB_HOST aponta para o nome do serviço (container) 'db' no Docker Compose
      DB_HOST: e03c5b123e9af615c6b7878f2ab4d352
    # Garante que o serviço 'db' seja iniciado antes do 'web'
    depends_on:
      - db

  # Serviço do Banco de Dados PostgreSQL
  db:
    # Usa a imagem oficial do PostgreSQL (versão estável e leve)
    image: postgres:14-alpine
    restart: always
    environment:
      # Variáveis de configuração padrão do PostgreSQL. Devem ser as mesmas usadas no serviço 'web'
      POSTGRES_USER: 6ba288924eb495dba130fd598d383dcb
      POSTGRES_PASSWORD: 7dd23931ba9b2ba58a5988c96fe8c018
      POSTGRES_DB: 6ba288924eb495dba130fd598d383dcb
    # Mapeia um volume para persistir os dados do banco no seu Docker Desktop
    volumes:
      - postgres_data:/var/lib/postgresql/data/
    # Opcional: Para acessar o BD diretamente
    # ports:
    #   - "5433:5432"

# Definição dos volumes (onde os dados reais serão armazenados no seu Docker Desktop)
volumes:
  postgres_data: